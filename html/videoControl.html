<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <title>title</title>
      <link rel="stylesheet" type="text/css" href="../css/aui.css"/>
      <link rel="stylesheet" type="text/css" href="../css/api.css"/>
      <link rel="stylesheet" href="../css/vant.css">
      <style>
        body,html{
          background-color: rgba(0, 0, 0, 0.1);
          animation: moveLeft 0.5s;
          -moz-animation: moveLeft 0.5s;	/* Firefox */
          -webkit-animation: moveLeft 0.5s;	/* Safari 和 Chrome */
          -o-animation: moveLeft 0.5s;	/* Opera */
          animation-delay: 2.0s;
          animation-fill-mode: forwards;/* 最后一帧 */
        }
        @keyframes moveLeft {
            0% {background-color: rgba(0, 0, 0, 0.1);}
            100% {background-color: rgba(0, 0, 0, 0);}
        }
        .aui-bar-nav{
          position: absolute;
          top: 0;
          background-color: rgba(0, 0, 0, 0.4);
        }

        footer{
          position: absolute;
          bottom: 0;
          background-color: rgba(0, 0, 0, 0.4);
          display: flex;
          width: 100%;
          height: 2.4rem;
          color: #fff;
          text-align:center;
          box-sizing: border-box;
        }
        footer>div{
          -webkit-flex: 2
          height: 2.4rem;
          line-height: 2.4rem;
          width: 15%
        }
        footer>.progress{
          -webkit-flex: 6;
          width: 10vw;
          /*padding: 0.6rem;
          padding-top: 1.1rem;*/
          box-sizing: border-box;
        }
        .footer-leave{
          animation: leaveBottom 1s;
          -moz-animation: leaveBottom 1s;	/* Firefox */
          -webkit-animation: leaveBottom 1s;	/* Safari 和 Chrome */
          -o-animation: leaveBottom 1s;	/* Opera */
          animation-delay: 2.0s;
          animation-fill-mode: forwards;/* 最后一帧 */
        }
        .footer-come{
          animation: comeBottom 1s;
          -moz-animation: comeBottom 1s;	/* Firefox */
          -webkit-animation: comeBottom 1s;	/* Safari 和 Chrome */
          -o-animation: comeBottom 1s;	/* Opera */
          animation-fill-mode: forwards;/* 最后一帧 */
        }
        .header-leave{
          animation: leaveTop 1s;
          -moz-animation: leaveTop 1s;	/* Firefox */
          -webkit-animation: leaveTop 1s;	/* Safari 和 Chrome */
          -o-animation: leaveTop 1s;	/* Opera */
          animation-delay: 2.0s;
          animation-fill-mode: forwards;/* 最后一帧 */
        }
        .header-come{
          animation: comeTop 1s;
          -moz-animation: comeTop 1s;	/* Firefox */
          -webkit-animation: comeTop 1s;	/* Safari 和 Chrome */
          -o-animation: comeTop 1s;	/* Opera */
          animation-fill-mode: comeTop;/* 最后一帧 */
        }
        @keyframes leaveBottom {
            0% {transform: translateY(0);}
            100% {transform: translateY(2.4rem);}
        }
        @keyframes comeBottom {
            0% {transform: translateY(2.4rem);}
            100% {transform: translateY(0);}
        }
        @keyframes leaveTop {
            0% {transform: translateY(0);}
            100% {transform: translateY(-2.4rem);}
        }
        @keyframes comeTop {
            0% {transform: translateY(-2.4rem);}
            100% {transform: translateY(0);}
        }
        .video-body{
          width: 100%;
          height: 200px;
          line-height: 200px;
          text-align: center;
          color: #fff;
        }
        .video-body>span{
          background-color: rgba(0, 0, 0, 0.4);
          width: 15vw;
          height: 15vw;
          font-size: 1.4rem;
          line-height: 2.8rem;
          border-radius: 50%;
          position: absolute;
          left:42.5vw;
          top:2.8rem;
        }
        .body-leave{
          animation: bodyLeave 1s;
          -moz-animation: bodyLeave 1s;	/* Firefox */
          -webkit-animation: bodyLeave 1s;	/* Safari 和 Chrome */
          -o-animation: bodyLeave 1s;	/* Opera */
          animation-delay: 2.0s;
          animation-fill-mode: forwards;/* 最后一帧 */
        }
        .body-come{
          animation: bodyCome 1s;
          -moz-animation: bodyCome 1s;	/* Firefox */
          -webkit-animation: bodyCome 1s;	/* Safari 和 Chrome */
          -o-animation: bodyCome 1s;	/* Opera */
          animation-fill-mode: forwards;/* 最后一帧 */
        }
        @keyframes bodyLeave {
            0% {opacity: 1}
            100% {opacity: 0;}
        }
        @keyframes bodyCome {
            0% {opacity: 0;}
            100% {opacity: 1;}
        }
        .van-slider__button{
          width: 3vw;
          height: 3vw;
        }
        .title{
          margin-left: 2vw;
        }
        .foot_play{
          width: 20px;
          height: 20px;
          object-fit: contain;
        }
        .f_c{
      	    display: flex;
      	    align-items: center;
      	}
        .mid_play{
          width: 8vw;
          height: 8vw;
          object-fit: contain;
        }
        .fcc{
      	    display: flex;
      	    justify-content: center;
      	    align-items: center;
      	}
        [v-cloak] {
          display:none !important;
        }
        .pad_d{
          padding: 0 4vw;
        }
        .time{
          width: 17vw;
          font-size: 3vw;
          padding: 0 1vw;
          box-sizing: border-box;
        }
        .fsbc{
      	    display: flex;
      	    justify-content: space-between;
      	    align-items: center;
      	}
        .foot_progress{
          width: calc(58vw - 40px);
        }
      </style>
  </head>
  <body>
    <div id="app" v-cloak>
      <header class="aui-bar aui-bar-nav">
          <div class="aui-pull-left aui-btn" @click="videoBack">
              <span class="aui-iconfont aui-icon-left"></span>
              <span class="title">{{title}}</span>
          </div>
          <div class="aui-pull-right aui-btn">
              <!-- <span class="aui-iconfont aui-icon-more"></span> -->
          </div>
      </header>
      <div class="video-body body-leave">
        <!-- <span class="aui-iconfont aui-icon-video"></span> -->
        <!-- <span v-if="!is_playing" class="fcc" @click="videoStart"><img class="mid_play" src="../image/video/play.png"/></span>
        <span v-if="is_playing" class="fcc" @click="videoPause"><img class="mid_play" src="../image/video/pause.png"/></span> -->
      </div>
      <footer class="f_c pad_d">
        <img v-if="!is_playing" @click="videoStart" class="foot_play" src="../image/video/play.png"/>
        <img v-if="is_playing" @click="videoPause" class="foot_play" src="../image/video/pause.png"/>
        <div class="time fcc">
          <span>{{time_now}}</span>
        </div>
        <div class="foot_progress" style="background-color:blue;">
          <van-slider @drag-start="percentStart" @drag-end="percentEnd" class="foot_progress" v-model="percent" @change="percentChange" />
        </div>
        <div class="time fcc">
          <span>{{time_all}}</span>
        </div>
          <img v-if="!full" @click="videoLandscape" class="foot_play" src="../image/video/full.png"/>
          <img v-if="full" @click="videoPortrait" class="foot_play" src="../image/video/full_n.png"/>
      </footer>
    </div>
  </body>
  <script type="text/javascript" src="../script/api.js"></script>
  <script type="text/javascript" src="../script/vue.js"></script>
  <script type="text/javascript" src="../script/vant.min.js"></script>
  <script type="text/javascript">
      apiready = function(){
        var timer = null;
        var vm = new Vue({
            el: '#app',
            data: {
              show:false,
              title:api.pageParam.title,
              percent: 0,
              duration:0,
              time_all:'00:00:00',
              time_now:'00:00:00',
              is_playing:api.pageParam.is_playing,
              full:api.pageParam.full,
            },
            mounted: function () {
              var that = this;
              if(api.pageParam.duration){
                that.duration = api.pageParam.duration;
              }
              api.addEventListener({
                  name:'tap'
              }, function(ret, err){
                console.log(that.show)
                if(that.show == false){
                  that.controlShow();
                }else{
                  clearTimeout(timer);
                  timer = setTimeout(function(){
                    that.controlHide();
                  },3500);
                }
              });
              this.controlShow();
              api.addEventListener({
                name : 'videoPlayer'
              }, function(ret, err) {
                if(ret.value.eventType != 'playing'){
                  console.log(JSON.stringify(ret))
                }
                if(ret.value.eventType == 'play'){
                  that.is_playing = true;
                  that.duration = ret.value.duration;
                  that.time_all = that.formatSeconds(ret.value.duration);
                }
                if(ret.value.eventType == 'playing'){
                  that.is_playing = true;
                  that.time_now = that.formatSeconds(ret.value.current);
                  that.percent = ret.value.current/that.duration * 100;
                  if(ret.value.current >= that.duration - 1){
                    that.is_playing = false;
                  }
                }
             });
            },
            methods:{
              percentStart(){
                clearTimeout(timer);
              },
              percentEnd(){
                var that = this;
                timer = setTimeout(function(){
                  that.controlHide();
                },2500);
              },
              percentChange(value) {
                var seconds = this.duration * value/100;
                api.sendEvent({
                    name: 'videoControl',
                    extra: {
                      eventType:'seekTo',
                      seconds:seconds
                    }
                });
              },
              formatSeconds(second) {
                second = parseInt(second);
                var hourTime = 0;
                var minuteTime = 0;
                var secondTime = 0;
                if (second > 60) {  //如果秒数大于60
                  minuteTime = Math.floor(second / 60);
                  secondTime = Math.floor(second % 60);
                  if (minuteTime >= 60) {  //如果分钟大于60
                    hourTime = Math.floor(minuteTime / 60);
                    minuteTime = Math.floor(minuteTime % 60);
                  } else {
                    hourTime = 0;
                  }
                } else {
                  hourTime = 0;
                  minuteTime = 0;
                  if (second == 60) {  //如果秒数等于60
                    minuteTime = 1;
                    secondTime = 0;
                  } else {
                    secondTime = second;
                  }
                }
                var timeResult = this._addZero(hourTime) + ':' +this._addZero(minuteTime) + ':' + this._addZero(secondTime);
                return timeResult;
              },
              _addZero(time) {
                let str = time;
                if (time < 10) {
                  str = '0' + time;
                }
                return str;
              },
              controlShow(){
                var that = this;
                $api.removeCls($api.dom('footer'), 'footer-leave');
                $api.removeCls($api.dom('header'), 'header-leave');
                $api.removeCls($api.dom('.video-body'), 'body-leave');
                $api.addCls($api.dom('footer'), 'footer-come');
                $api.addCls($api.dom('header'), 'header-come');
                $api.addCls($api.dom('.video-body'), 'body-come');
                this.show = true;
                clearTimeout(timer);
                timer = setTimeout(function(){
                  that.controlHide();
                },3500);
              },
              controlHide(){
                var that = this;
                $api.removeCls($api.dom('footer'), 'footer-come');
                $api.removeCls($api.dom('header'), 'header-come');
                $api.removeCls($api.dom('.video-body'), 'body-come');
                $api.addCls($api.dom('footer'), 'footer-leave');
                $api.addCls($api.dom('header'), 'header-leave');
                $api.addCls($api.dom('.video-body'), 'body-leave');
                setTimeout(function(){
                  that.show = false;
                },1000)
              },
              videoBack(){
                if(this.full){
                  this.videoPortrait();
                }else{
                  api.sendEvent({
                      name: 'videoControl',
                      extra: {
                        eventType:'back'
                      }
                  });
                }
              },
              videoStart(){
                api.sendEvent({
                    name: 'videoControl',
                    extra: {
                      eventType:'start'
                    }
                });
                this.is_playing = true;
              },
              videoPause(){
                api.sendEvent({
                    name: 'videoControl',
                    extra: {
                      eventType:'pause'
                    }
                });
                this.is_playing = false;
              },
              videoLandscape(){
                api.sendEvent({
                    name: 'videoControl',
                    extra: {
                      eventType:'landscape'
                    }
                });
                this.full = true;
              },
              videoPortrait(){
                api.sendEvent({
                    name: 'videoControl',
                    extra: {
                      eventType:'portrait'
                    }
                });
                this.full = false;
              },

            }
        })
      };
  </script>
  </html>
