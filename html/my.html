<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport"
    content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
  <title>我的</title>
  <link rel="stylesheet" type="text/css" href="../css/api.css" />
  <link rel="stylesheet" href="../css/aui.css">
  <link rel="stylesheet" href="../css/add.css">
  <link rel="stylesheet" href="../css/style2.css">
  <style>
    body,
    html {
      height: auto;
      background-color: #f3f3f3;
    }

    [v-cloak] {
      display: none
    }

    #app {
      overflow: hidden;
    }



    #header .aui-title {
      color: #000;

    }

    #header .aui-icon-left {
      color: #000
    }

    #header {
      padding: 0 3.333vw;
      box-sizing: border-box;
      position: fixed;
      top: 0;
      left: 0;
      background-color: #0094FA;
      height: 11.733vw;
      background-image: linear-gradient(to right, #5bbbff, #289bff);
    }

    #my_message {
      position: relative;
      margin-top: 11.533vw;
      height: 15.2vw;
      width: 100%;
      background-image: linear-gradient(to right, #5bbbff, #289bff);

    }

    #my_show {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translateX(-50%);
      background-color: #fff;
      width: 88vw;
      height: 21.6vw;
      border-radius: 4.667vw;
    }

    #my_photo {
      width: 13.6vw;
      float: left;
      height: 13.6vw;
      background-image: url(../image/iconimg/linshitx.png);
      background-size: contain;
      border-radius: 50%;
      position: absolute;
      top: 50%;
      left: 4.533vw;
      transform: translateY(-50%);
      overflow: hidden;
    }

    #my_photo img {
      width: 100%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);

    }

    #user {
      float: left;

      margin-left: 22.133vw;
    }

    #name {

      float: left;
      margin-top: 5.067vw;

      font-size: 4.667vw;
      font-weight: 800;
    }

    #name p {
      font-size: 4.267vw;
      float: left;
    }

    #vip {
      display: inline-block;

    }


    #vip_time {
      font-size: 2.667vw;
      color: #aaa;
      /* margin-top: 2.2vw; */

    }

    #integral {
      float: right;
      text-align: center;
      margin-top: 3.067vw;
      color: #aaa;
      font-size: 2.933vw;
    }

    #integral i {
      color: black;
      display: inline-block;
      padding: 2vw 0;
      font-size: 3.733vw;

    }

    #integral span {
      margin-right: 6vw
    }

    #my_service,
    #my_more {
      width: 88.267vw;
      margin: 20.667vw auto;
    }

    #my_service {
      margin-bottom: 13vw;
    }

    #my_more {
      margin-top: 13vw;
    }

    h2 {
      font-size: 4.267vw;
      margin-bottom: 6.667vw;
      height: 4vw;
      line-height: 4vw;
      font-weight: 800;
      font-size: 4.267vw;
    }



    ul {
      display: flex;
      flex-wrap: wrap;
      width: 88.267vw;
      text-align: center;
      background-color: #fff;
      border-radius: 4.667vw;
      padding: 2.933vw 0;



    }

    #ul_list li {
      width: 33%;
      height: 21.867vw;
      text-align: center;
    }



    li p {
      font-size: 2.933vw;
    }

    #ul li {

      width: 25%;
      height: 21.867vw;
      text-align: center;
      padding: 1.033vw 0;
    }

    #ul li .img {
      position: relative;
      width: 100%;
      height: 7.133vw;
      line-height: 7.133vw;
      margin: 3.333vw auto;
      text-align: center;
      /* vertical-align:middle; */
    }

    #ul li .img img {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      margin: 0 auto;
      width: 6.8vw;
      height: 6.8vm;
    }


    #ul_list li .img {
      position: relative;
      width: 100%;
      height: 8.8vw;
      line-height: 8.8vw;
      margin: 3.333vw auto;
    }

    #ul_list li .img img {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      margin: 0 auto;
      width: 7.067vw;
      /* height: 9.8vm; */
    }

    .span {
      display: inline-block;
      width: 0.8vw;
      height: 3.067vw;
      background-color: #2397ff;
      line-height: 4vw;
      border-radius: 1.333vw;
      margin-right: 1.333vw;

    }


    .newsico img {
      width: 5vw;
      height: 6.3vw;
    }

    .banxin {
      width: 88.267vw;
      margin: 0 auto;
    }

    .star {
      position: relative;
      width: 19vw;
      height: 6vw;
      display: inline-block;
      margin-left: 2.5vw
    }

    .star img {
      height: 2.533vw;
      position: absolute;
      top: 50%;
      left: 0;
      transform: translateY(-50%);

    }
  </style>
</head>

<body>
  <div id="app" v-cloak>
    <!-- 头部 -->
    <header id="header" class="aui-bar aui-bar-nav">
      <!-- 左侧消息提示 -->
      <div class="banxin">
        <div class="aui-pull-left aui-btn" @click='bindmsg'>
          <span class="newsico" style="position:relative;">
            <img src="../image/iconimg/tongzhi.png" alt="">
            <span v-if="weidu"
              style="width:2vw;height:2vw;border-radius:50%;background-color:red;position:absolute;right:-1vw;top:-1vw;"></span>
          </span>
        </div>
        <!-- 右侧 -->
        <div style="color: #fff" class="aui-pull-right aui-btn">
          <!-- 收藏 -->
          <span @click='turnFav' id="icon" style="width:5.6vw;height:6vw;"><img src="../image/iconimg/shoucang.png"
              alt=""></span>&nbsp&nbsp&nbsp
          <!-- 设置 -->
          <span id="icon" style="width:5.333vw;height:6vw;" @click="setting"><img src="../image/iconimg/shezhi.png"
              alt=""></span>
        </div>
      </div>
    </header>
    <div id="main">
      <!-- 我的信息 -->
      <div id="my_message">
        <!-- 个人信息展示 -->
        <div id="my_show">
          <!-- 头像 -->
          <div id="my_photo" @click='navSetup'>
            <img v-if='info' :src="info.avatar" alt="">
          </div>
          <!-- 昵称与会员 -->
          <div id="user">
            <!-- 昵称 -->
            <div id="name" style="font-weight: bold;" v-if='info'>
              <p>
                {{info.nickname}}
              </p>
              <!-- vip -->
              <img id="vip" style="width:6vw;height:6vw;margin-left:1vw;" v-if='is_vip==true' class="fit"
                src="../image/iconimg/vip1.png" />
              <img id="vip" style="width:6vw;height:6vw;margin-left:1vw;" class="fit" src="../image/iconimg/vip.png"
                v-if='is_vip==false' />
              <!-- 星级 -->
              <div class="star" @click="turnOutput">
                <img src="../image/star/1.1.png" alt="" v-if="info.score>1&&info.score<=1000">
                <img src="../image/star/1.2.png" alt="" v-if="info.score>1000&&info.score<=2000">
                <img src="../image/star/1.3.png" alt="" v-if="info.score>2000&&info.score<=3000">
                <img src="../image/star/1.4.png" alt="" v-if="info.score>3000&&info.score<=5000">
                <img src="../image/star/1.5.png" alt="" v-if="info.score>5000&&info.score<=7000">
                <img src="../image/star/2.1.png" alt="" v-if="info.score>7000&&info.score<=9000">
                <img src="../image/star/2.2.png" alt="" v-if="info.score>9000&&info.score<=11000">
                <img src="../image/star/2.3.png" alt="" v-if="info.score>11000&&info.score<=13000">
                <img src="../image/star/2.4.png" alt="" v-if="info.score>13000&&info.score<=15000">
                <img src="../image/star/2.5.png" alt="" v-if="info.score>15000&&info.score<=17000">
                <img src="../image/star/3.1.png" alt="" v-if="info.score>17000&&info.score<=19000">
                <img src="../image/star/3.2.png" alt="" v-if="info.score>19000&&info.score<=22000">
                <img src="../image/star/3.3.png" alt="" v-if="info.score>22000&&info.score<=25000">
                <img src="../image/star/3.4.png" alt="" v-if="info.score>25000&&info.score<=28000">
                <img src="../image/star/3.5.png" alt="" v-if="info.score>28000&&info.score<=32000">
                <img src="../image/star/4.1.png" alt="" v-if="info.score>32000&&info.score<=36000">
                <img src="../image/star/4.2.png" alt="" v-if="info.score>36000&&info.score<=40000">
                <img src="../image/star/4.3.png" alt="" v-if="info.score>40000&&info.score<=45000">
                <img src="../image/star/4.4.png" alt="" v-if="info.score>45000&&info.score<=50000">
                <img src="../image/star/4.5.png" alt="" v-if="info.score>50000&&info.score<=55000">
                <img src="../image/star/5.1.png" alt="" v-if="info.score>55000&&info.score<=60000">
                <img src="../image/star/5.2.png" alt="" v-if="info.score>60000&&info.score<=65000">
                <img src="../image/star/5.3.png" alt="" v-if="info.score>65000&&info.score<=70000">
                <img src="../image/star/5.4.png" alt="" v-if="info.score>70000&&info.score<=80000">
                <img src="../image/star/5.5.png" alt="" v-if="info.score>80000&&info.score<=90000">
                <img src="../image/star/6.1.png" alt="" v-if="info.score>90000&&info.score<=100000">
                <img src="../image/star/6.2.png" alt="" v-if="info.score>100000&&info.score<=110000">
                <img src="../image/star/6.3.png" alt="" v-if="info.score>110000&&info.score<=120000">
                <img src="../image/star/6.4.png" alt="" v-if="info.score>120000&&info.score<=130000">
                <img src="../image/star/6.5.png" alt="" v-if="info.score>130000&&info.score<=140000">
                <img src="../image/star/7.1.png" alt="" v-if="info.score>140000&&info.score<=160000">
                <img src="../image/star/7.2.png" alt="" v-if="info.score>160000&&info.score<=180000">
                <img src="../image/star/7.3.png" alt="" v-if="info.score>180000&&info.score<=200000">
                <img src="../image/star/7.4.png" alt="" v-if="info.score>200000&&info.score<=220000">
                <img src="../image/star/7.5.png" alt="" v-if="info.score>220000&&info.score<=240000">
              </div>
              <!-- 到期时间 -->
              <div id="vip_time" v-if='is_vip==true' style="font-weight: 400;">会员到期时间:{{viptype}}</div>
              <div id="vip_time" v-if='is_vip==false' style="font-weight: 400;" @click='bindvip'>开通会员</div>
            </div>
          </div>
          <!-- 积分 -->
          <div id="integral">
            <span @click='bindteacher'>
              <i style="font-size: 4.633vw;">{{number}}</i><br>
              关注
            </span>
          </div>
        </div>
      </div>
      <!-- 我的服务 -->
      <div id="my_service">
        <h2><span class="span" style="height: 3.067vw;"></span>&nbsp;我的服务</h2>
        <ul id="ul_list">
          <li @click='navCourse(-1)'>
            <div class="img"><img src="../image/iconimg/kecheng.png" alt=""></div>
            <p>我的课程</p>
          </li>
          <li @click='naverrTopic'>
            <div class="img"><img src="../image/iconimg/tiku.png" alt=""></div>
            <p>我的题库</p>
          </li>
          <li @click='turnHistory'>
            <div class="img"><img src="../image/iconimg/lishi.png" alt=""></div>
            <p>观看历史</p>
          </li>
        </ul>
      </div>
      <!-- 更多服务 -->
      <div id="my_more">
        <h2><span class="span" style="height: 3.067vw;"></span>&nbsp;更多服务</h2>
        <ul id="ul">
          <li @click='bindvip'>
            <div class="img"><img src="../image/iconimg/vipzx.png" alt=""></div>
            <p>VIP中心</p>
          </li>
          <li @click='bindyaoqing'>
            <div class="img"><img src="../image/iconimg/yq.png" alt=""></div>
            <p>邀请学员</p>
          </li>
          <li @click='bindxiaof'>
            <div class="img"><img src="../image/iconimg/xfls.png" alt=""></div>
            <p>消费历史</p>
          </li>
          <li @click='kefu'>
            <div class="img"><img src="../image/iconimg/kf.png" alt=""></div>
            <p>客服咨询</p>
          </li>
          <li @click='bindabout'>
            <div class="img"><img src="../image/iconimg/js.png" alt=""></div>
            <p>我是教师</p>
          </li>
          <li @click="bindcoupon_win">
            <div class="img"><img src="../image/iconimg/yhq.png" alt=""></div>
            <p>优惠券</p>
          </li>
          <li @click='turnCards'>
            <div class="img"><img src="../image/iconimg/yhk.png" alt=""></div>
            <p>银行卡</p>
          </li>
          <li @click='bindacconut'>
            <div class="img"><img src="../image/iconimg/zh.png" alt=""></div>
            <p>我的账户</p>
          </li>
        </ul>
      </div>
    </div>
  </div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/vue.js"></script>
<script type="text/javascript" src="../script/moment.js"></script>
<script src="../script/jquery.min.js"></script>
<script src="../script/configUtil.js" charset="utf-8"></script>
<script src="../script/util.js" charset="utf-8"></script>
<script type="text/javascript">
  apiready = function () {
    api.setStatusBarStyle({
      style: 'dark',
    })
    var header = document.querySelector('#header');
    var main = document.querySelector('#main');
    $api.fixStatusBar(header);
    $api.fixStatusBar(main);
    var vm = new Vue({
      el: '#app',
      data: {
        user: true,
        token: window.localStorage.getItem('userinfo') || '',
        money: '',
        title: '',
        mask: false,
        info: '',
        viptype: false,
        weidu: false,
        isshenhe: -1,
        is_vip: false,
        number: 0,
        page: 1
      },
      mounted: function () {
        var that = this
        var header = document.querySelector('#header');
        $api.fixStatusBar(header);
        //创建美洽
        var mq = api.require('meiQia');
        //配置初始化美洽需要的appkey
        var param = {
          appkey: "f4790d20eeef104610bede0a459f61de"
        };
        //初始化美洽
        mq.initMeiQia(param, function (ret, err) {
          if (ret) {
            //初始化成功
            // alert(JSON.stringify(ret));
          } else {
            //初始化失败
            // alert(JSON.stringify(err));
          }
        })
        this.userInfo();
        this.initdata();
        this.$nextTick(() => {
          api.addEventListener({
            name: 'my_setup'
          }, function (ret, err) {
            that.userInfo();
          });

        })

        api.addEventListener({
          name: 'my_to_home'
        }, function (ret, err) {

          api.setFrameGroupIndex({
            name: "group",
            index: 0,
            scroll: false,
            reload: false
          });

        });

        api.addEventListener({
          name: 'root_data'
        }, function (ret, err) {
          that.userInfo()
          that.accoutinfo()
          that.uservip();
          // that.initData();
        });
        api.addEventListener({
          name: 'buybuy'
        }, function (ret, err) {
          that.uservip();
        });
        that.userInfo()
        that.accoutinfo()
        that.uservip();
        // that.initData();
        that.getWeidu();
        api.addEventListener({
          name: 'getWeidu'
        }, function (ret, err) {
          that.getWeidu();
        });
        this.getIsshenhe();
      },
      methods: {
        getIsshenhe() {
          var that = this;
          that.ajaxpost('post', globalData.isshenhe, {}).then((res) => {
            var res = $.parseJSON(res);
            api.refreshHeaderLoadDone()
            if (res.code == 1) {
              that.isshenhe = res.data.status;
            }
          }).catch((ret) => {
            loginfo(ret)
          })
        },
        // 消息未读
        getWeidu() {
          var that = this;
          that.ajaxpost_noloading('post', globalData.checkNoReadMessage, {}).then((res) => {
            var res = $.parseJSON(res);
            if (res.data.count > 0) {
              that.weidu = true
            }
          }).catch((ret) => {
            loginfo(ret)
          })
        },
        // 银行卡
        turnCards() {
          this.openW('card_list', {}, true, null, false);
        },
        // 收藏
        turnFav() {
          this.openW('video_fav', {}, true, null, false);
        },
        // 观看历史
        turnHistory() {
          this.openW('history_frm', {}, true, null, false);
        },
        // 积分商城
        turnOutput() {
          this.openW('output_win', {}, true);
        },

        // 实名认证
        // initData() {
        //   var that = this;
        //   var param = {
        //     applytype: 1
        //   }
        //   that.ajaxpost_noloading('post', globalData.getMemberApplyStatus, param).then((res) => {
        //     var res = $.parseJSON(res);
        //     if (res.code == 1) {
        //       if (res.data.status == 1) {
        //         that.status = '已实名'
        //       } else {
        //         that.status = '实名认证'
        //       }
        //     }

        //   }).catch((ret) => {
        //     loginfo(ret)
        //   })
        // },
        // 消息
        bindmsg() {

          this.openW('my_msg_win', {}, true)
        },
        //头像
        imgsetup() {
          var that = this;

          that.uploadfirst(function (res) {
            if (res.code == 1) {
              that.toast(res.msg)
              that.info.avatar = res.data.user_image
            } else {
              loginfo(res)
            }
          }, globalData.uploadAvatar, 'pic', {
            imges: '上传头像'
          })
        },
        //info
        accoutinfo() {
          var that = this;
          var data = {

          }
          that.ajaxpost_noloading('post', globalData.getUserBalance, data).then((res) => {

            var res = $.parseJSON(res);

            if (res.code == 1) {
              that.money = res.data
            }
          }).catch((ret) => {
            loginfo(ret)
          })
        },

        // 获取会员信息
        uservip() {
          var that = this
          var data = {

          }
          that.ajaxpost_noloading('post', globalData.getMemberIsVip, data).then((res) => {

            var res = $.parseJSON(res);
            console.log(JSON.stringify(res))
            if (res.code == 1) {
              that.viptype = moment.unix(res.data.is_vip).format('YYYY-MM-DD');

            }
            // alert(JSON.stringify(res))

            if (res.data.is_vip != '') {
              that.is_vip = true
            }

          }).catch((ret) => {
            loginfo(ret)
          })
        },
        // 获取个人信息
        userInfo() {
          var that = this
          var data = {

          }
          that.ajaxpost_noloading('post', globalData.userInfo, data).then((res) => {
            var res = $.parseJSON(res);
            // console.log(JSON.stringify(res))
            window.localStorage.setItem('mobile', res.data.mobile)
            getLevel(res.data.score, function (level) {
              res.data.level = level;
              that.info = res.data
            })
          }).catch((ret) => {
            loginfo(ret)
          })
        },
        //获取关注数量
        initdata() {
          var that = this;
          var data = {
            page: that.page,
            limit: 10
          }
          that.ajaxpost('post', globalData.followList, data).then((res) => {

            var res = $.parseJSON(res);
            // alert(JSON.stringify(res))
            that.number = res.data.data.length

          }).catch((ret) => {
            loginfo(ret)
          })
        },


        //老师
        bindteacher() {
          var that = this;
          that.openW('my_attention_teacher_win', {}, true);
        },

        //邀请
        bindyaoqing() {
          // this.mask=true;
          // var sharedModule = api.require('shareAction');
          // var phonetype = api.systemType;
          // if(phonetype=='android'){
          //   sharedModule.share({
          //         text: '邀请码：123',
          //         type: 'url',
          //         path:'http://www.baidu.com',
          //
          //     });
          // }else{
          //   sharedModule.share({
          //         text: '邀请码：123',
          //         type: 'url',
          //         path:'http://www.baidu.com',
          //
          //     });
          // }
          this.openW('my_yaoq_h', {}, true);
          // api.actionSheet({
          //     title: '底部弹出框测试',
          //     cancelTitle: '这里是取消按钮',
          //     destructiveTitle: '红色警告按钮',
          //     buttons: ['1', '2', '3']
          // }, function(ret, err) {
          //     // var index = ret.buttonIndex;
          //     console.log(JSON.stringify(ret))
          // });
        },
        //错题
        naverrTopic() {
          this.openW('question_bank_h', {}, true)
        },
        //课程
        navCourse(id) {
          var data = {
            type: 1,
            Flid: id
          }
          this.openW('course_h', data, true)
        },
        //签到
        navSign() {
          this.openW('my_signin_win', {}, true)
        },
        //修改资料
        navSetup() {
          this.openW('my_setup_h', {}, true)
        },
        //订单
        bindorder() {
          var that = this;
          that.openW('my_order_win', {}, true);
        },
        //优惠劵
        bindcoupon_win() {
          var that = this;
          var data = {
            title: '优惠券区',
            type: 2
          }
          that.openW('coupon_win', data, true);
        },

        //会员
        bindvip() {
          var that = this;
          that.openW('dredge_vip_win', {}, true);
        },
        //消费管理
        bindxiaof() {
          var that = this;
          that.openW('purchase_history_win', {}, true);
        },
        // 拨打热线
        // onmoble() {
        //   api.call({
        //     type: 'tel_prompt',
        //     number: '400-928-6877'
        //   });
        // },
        //客服
        kefu() {
          var mq = api.require('meiQia');
          //设置title以及按钮颜色
          var titleColor = {
            color: "#000000"
          };
          mq.setTitleColor(titleColor);

          mq.show({
            showAvatar: false
          });
        },
        //账户
        bindacconut() {
          var that = this;
          that.openW('my_account', {}, true);
        },
        //我是教师
        bindabout() {
          var that = this;
          that.openW('my_about', {}, true);
        },
        //积分商城
        bindmy_amass() {
          var that = this;
          that.openW('my_amass', {}, true);
        },
        //设置
        setting() {
          var that = this;
          that.openW('my_setting', {}, true);
        },
        //关闭弹出框
        bindClosemask: function () {
          this.mask = false;

        },

      },


    })

  };
</script>

</html>