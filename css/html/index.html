<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <title>login</title>
      <link rel="stylesheet" type="text/css" href="../css/api.css" />
      <link rel="stylesheet" href="../css/aui.css">
      <link rel="stylesheet" href="../css/add.css">
      <!-- <link rel="stylesheet" href="css/style.css"> -->
      <style>
          body{
          }
          #app{
            background: url(../image/login_bg.png);
            background-size: 100vw;
            background-repeat: no-repeat;
            padding-top: 124.4vw;
            box-sizing: border-box;
            position: relative;
          }
          .buttons{
            margin: 11vw 10vw 15vw;
          }
          .buttons div{
            height: 10.4vw;
            border-radius: 5.2vw;
            font-size: 4vw;
            text-align: center;
            line-height: 10.4vw;
          }
          .buttons .button_login{
            color: #0C64CD;
            border: 1px solid #4E9BEF;
          }
          .buttons .button_registered{
            margin-top: 5.7vw;
            color: #ffffff;
            background: linear-gradient(to bottom, #479FFD, #0B64CD);
          }
          .login_mask{
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, .6);
            display: flex;
            justify-content: center;
            align-items: center;
          }
          .login{
            width: 87vw;
            height: 67.7vw;
            background: #ffffff;
            border-radius: 3vw;
            padding: 10vw 6vw;
            box-sizing: border-box;
          }
          .forgotPassword{
            width: 87vw;
            height: 94.7vw;
            background: #ffffff;
            border-radius: 3vw;
            padding: 10vw 6vw;
            box-sizing: border-box;
          }
          .registered{
            width: 87vw;
            height: 124.5vw;
            background: #ffffff;
            border-radius: 3vw;
            padding: 8vw 6vw;
            box-sizing: border-box;
          }
          .login > div,.forgotPassword > div,.registered > div{
            display: flex;
            align-items: center;
            line-height: 10vw;
            height: 10vw;
            border-bottom: 1px solid #CCCCCC;
            margin-bottom: 4vw;
          }
          .login > div > img,.forgotPassword > div > img,.registered > div > img{
            width: 4vw;
          }
          .login .eye,.forgotPassword .eye,.registered .eye{
            width: 5.5vw;
          }
          .login input,.forgotPassword input,.registered input{
            outline: none;
            margin-left: 3vw;
          }
          .login input::-webkit-input-placeholder,.forgotPassword input::-webkit-input-placeholder,.registered input::-webkit-input-placeholder{
            font-size: 3.5vw;
            color: #999999;
          }
          .forget{
            color: #0164cf;
            font-size: 2.6vw;

            display: flex;
            justify-content: space-between;
          }
          .go_login{
            height: 10.4vw;
            line-height: 10.4vw;
            text-align: center;
            border-radius: 5.2vw;
            color: #ffffff;
            font-size: 3.4vw;
            background: linear-gradient(to bottom, #479FFD, #0B64CD);

          }
          .get_code{
            font-size: 2.8vw;
            width: 24vw;
            height: 6.4vw;
            line-height: 6.4vw;
            border-radius: 3.2vw;
            color: #0164cf;
            border: 1px solid #347EBD;
            text-align: center;
          }
          .registered .legal{
            display: flex;

            border-bottom: none;
            font-size: 2.8vw;
            color: #0164cf;
          }
          .login .legal{
            display: flex;
            border-bottom: none;
            align-items: center;
            font-size: 2.8vw;
            color: #0164cf;
          }
          .login .choose img{
            vertical-align: middle;
          }
          .choose{
            width: 3.2vw;
            height: 3.2vw;
            border-radius: 50%;
            border: 1px solid #A9A9A9;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 1vw;
          }
          [v-cloak]{
            display: none;
          }
          .find_addfixed{
            position: fixed;
            right: 5vw;
            top: 10vw;
            width: 15vw;
            text-align: center;
            line-height: 5vw;
            height: 5vw;
            border-radius: 10px;
            border: 1px solid #eee;
            color: #fff;
            background-color: #999999;
          }
          .ltl-layer{
    z-index: 99999;
    width: 67vw;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    border-radius: 2vw;
    padding: 5vw 0 0vw;
}
.ltl-ok{
    text-align: center;
}
.ltl-ok h3{
    font-size: 4vw;
    color: #333333;
}
.ltl-ok p{
    font-size: 3.2vw;
    color: #666666;
    padding: 2vw;
    line-height: 4vw;
    text-align: left;
}
.ltl-ok-btn{
    margin-top: 6vw;
    padding: 3.5vw 0;
    border-top: 1px solid #f5f5f5;
}
.ltl-ok-btn a{
    font-size: 3.467vw;
}
.close_icon{
  width: 4vw;
  height: 4vw;
  position: absolute;
  right: 3vw;
  top: 3vw;
}
      </style>
  </head>
  <body>
  <div id="app" v-cloak>
    <div class="buttons">
      <div class="button_login" @click='showLoginBox'>密码登录</div>
      <div style="margin-top: 5.7vw;" class="button_login" @click='showLogin1Box'>短信登录</div>
      <div class="button_registered" @click='showRegisteredBox'>注册</div>
    </div>
    <div class="find_addfixed" @click='navhome'>
      跳过
    </div>
    <div class="login_mask" v-show='showLogin || showRegistered || showForget||flrst_xy||show1Login' @click='closeBox'>
      <div class="login" v-show='showLogin' @click.stop style="position:relative;">
        <img @click='closeBox' class="close_icon" src="../image/close.png">
        <div>
          <img src="../image/phone.png" alt="">
          <input type="number" placeholder="请输入手机号码" v-model='loginData.phone'>
        </div>
        <div style="justify-content: space-between;">
          <img src="../image/lock.png" alt="">
          <input type="password" style="width: 65vw;" v-model='loginData.password' placeholder="请输入登录密码" v-show='!loginData.showEye'>
          <input type="text" style="width: 65vw;"  v-model='loginData.password' placeholder="请输入登录密码" v-show='loginData.showEye'>
          <img src="../image/eye2.png" class="eye" alt="" v-show='loginData.showEye' @click='closeOropen(1)'>
          <img src="../image/eye.png" class="eye" alt="" v-show='!loginData.showEye' @click='closeOropen(1)'>
        </div>
        <div class="forget">
          <span  @click='forget'>忘记密码</span>
          <!-- <span @click='xiuy'>用户协议</span> -->

          <div class="legal" @click='registeredData.islg=!registeredData.islg'>
            <p class="choose">
              <img src="../image/choose.png" style="width: 2.5vw;height: 2.5vw;" v-show='registeredData.islg' alt="">
            </p>
            <span >保持登录状态</span>
          </div>

          <div class="legal">
            <p class="choose" @click='registeredData.isxiey=!registeredData.isxiey'>
              <img src="../image/choose.png" style="width: 2.5vw;height: 2.5vw;" v-show='registeredData.isxiey' alt="">
            </p>
            <span @click='showXieyBox()'>用户协议</span>
          </div>
        </div>

        <p class="go_login" @click='login'>立即登录</p>
      </div>
      <div class="login" v-show='show1Login' @click.stop style="position:relative;">
        <img @click='closeBox' class="close_icon" src="../image/close.png">
        <div>
          <img src="../image/phone.png" alt="">
          <input type="number" placeholder="请输入手机号码" v-model='loginData.phone'>
        </div>
        <div style="position:relative;">
          <img src="../image/lock.png" alt="">
          <input type="text" style="width: 40vw;"  v-model='loginData.code' placeholder="请输入验证码">
          <div class="f_mid" style="color: #1f8dfe;font-size:3.3vw;position:absolute;right:2vw;">
            <span v-show='!code_view'>剩余({{time}}s)</span>
            <span v-show='code_view' @click='getAddCode' :disabled='isDisabled'>发送验证码</span>
          </div>
        </div>
        <div class="forget">
          <span  @click='forget'>忘记密码</span>
          <!-- <span @click='xiuy'>用户协议</span> -->

          <div class="legal" @click='registeredData.islg=!registeredData.islg'>
            <p class="choose">
              <img src="../image/choose.png" style="width: 2.5vw;height: 2.5vw;" v-show='registeredData.islg' alt="">
            </p>
            <span >保持登录状态</span>
          </div>

          <div class="legal">
            <p class="choose" @click='registeredData.isxiey=!registeredData.isxiey'>
              <img src="../image/choose.png" style="width: 2.5vw;height: 2.5vw;" v-show='registeredData.isxiey' alt="">
            </p>
            <span @click='showXieyBox()'>用户协议</span>
          </div>
        </div>

        <p class="go_login" @click='login1'>立即登录</p>
      </div>
      <div class="registered" v-show='showRegistered' @click.stop style="position:relative;">
        <img @click='closeBox' class="close_icon" src="../image/close.png">
        <div>
          <img src="../image/phone.png" alt="">
          <input  type="number" maxlength="11" placeholder="请输入手机号码" v-model='registeredData.phone'>
        </div>
        <div>
          <img src="../image/shield.png" alt="">
          <input type="number"  placeholder="请输入验证码" v-model='registeredData.code'>
          <div class="get_code" @click='getCode(2)'>{{registeredData.canGetCode?'获取验证码':registeredData.time + 's'}}</div>
        </div>
        <div>
          <img src="../image/user.png" alt="">
          <input type="text" maxlength="10" placeholder="请输入昵称" v-model='registeredData.userName'>
        </div>
        <div>
          <img src="../image/lock.png" alt="">
          <input type="password" style="width: 65vw;" v-model='registeredData.password' placeholder="请输入登录密码" v-show='!registeredData.showEye1'>
          <input type="text" style="width: 65vw;" v-model='registeredData.password' placeholder="请输入登录密码" v-show='registeredData.showEye1'>
          <img src="../image/eye2.png" class="eye" alt="" v-show='registeredData.showEye1' @click='closeOropen(4)'>
          <img src="../image/eye.png" class="eye" alt="" v-show='!registeredData.showEye1' @click='closeOropen(4)'>
        </div>
        <div style="margin-bottom: 2vw;">
          <img src="../image/lock.png" alt="">
          <input type="password" style="width: 65vw;" v-model='registeredData.passwordAgain' placeholder="请再次输入密码" v-show='!registeredData.showEye2'>
          <input type="text" style="width: 65vw;" v-model='registeredData.passwordAgain' placeholder="请再次输入密码" v-show='registeredData.showEye2'>
          <img src="../image/eye2.png" class="eye" alt="" v-show='registeredData.showEye2' @click='closeOropen(5)'>
          <img src="../image/eye.png" class="eye" alt="" v-show='!registeredData.showEye2' @click='closeOropen(5)'>
        </div>
        <div style="margin-bottom: 2vw;">
          <img src="../image/lock.png" alt="">
          <input type="text" style="width: 65vw;" v-model='registeredData.refer_code' placeholder="邀请码(选填)" >
        </div>
        <span class="color9 f_c" style="border:none;font-size:3.3vw;height:5vw;"><span style="color:red;">*</span>请输入6-12位字母加数字的密码</span>
        <div class="legal">
          <p class="choose" @click='noClause'>
            <img src="../image/choose.png" style="width: 2.5vw;height: 2.5vw;" v-show='registeredData.isChoose' alt="">
          </p>
          <span @click='showClauseBox()'>隐私协议</span>
        </div>
        <p class="go_login" @click='registered'>立即注册</p>
      </div>
      <div class="forgotPassword" v-show='showForget' @click.stop style="position:relative;">
        <img @click='closeBox' class="close_icon" src="../image/close.png">
        <div>
          <img src="../image/phone.png" alt="">
          <input type="number" maxlength="11" placeholder="请输入手机号码" v-model='forgetData.phone'>
        </div>
        <div>
          <img src="../image/shield.png" alt="">
          <input type="number" placeholder="请输入验证码" v-model='forgetData.code'>
          <div class="get_code" @click='getCode(1)'>{{forgetData.canGetCode?'获取验证码':forgetData.time + 's'}}</div>
        </div>
        <div>
          <img src="../image/lock.png" alt="">
          <input type="password" style="width: 65vw;" v-model='forgetData.password' placeholder="请输入登录密码" v-show='!forgetData.showEye1'>
          <input type="text" style="width: 65vw;" v-model='forgetData.password' placeholder="请输入登录密码" v-show='forgetData.showEye1'>
          <img src="../image/eye2.png" class="eye" alt="" v-show='forgetData.showEye1' @click='closeOropen(2)'>
          <img src="../image/eye.png" class="eye" alt="" v-show='!forgetData.showEye1' @click='closeOropen(2)'>
        </div>
        <div>
          <img src="../image/lock.png" alt="">
          <input type="password" style="width: 65vw;" v-model='forgetData.passwordAgain' placeholder="请再次输入密码" v-show='!forgetData.showEye2'>
          <input type="text" style="width: 65vw;" v-model='forgetData.passwordAgain' placeholder="请再次输入密码" v-show='forgetData.showEye2'>
          <img src="../image/eye2.png" class="eye" alt="" v-show='forgetData.showEye2' @click='closeOropen(3)'>
          <img src="../image/eye.png" class="eye" alt="" v-show='!forgetData.showEye2' @click='closeOropen(3)'>
        </div>
        <p class="go_login" :style='{marginTop:(showForget?"10vw":"")}' @click='forgotPassword'>提交</p>
      </div>
    </div>
    <div class="ltl-layer" v-show='flrst_xy'>
      <div class="ltl-ok">
          <h3>用户协议和隐私协议</h3>
          <p>请你阅读 <span style="color: #0B64CD;" @click='showXieyBox()'>《用户协议》</span>和 <span @click='showClauseBox()' style="color: #0B64CD;">《隐私协议》</span>了解详细信息。如同意，请点击“同意”开始我们的服务</p>
          <div class="ltl-ok-btn " style="width: 80%;margin: auto; display: flex; justify-content: space-between;"><a class="ltl-blue" @click='is_xyShow(1)' >暂不使用</a><a class="ltl-blue" @click='is_xyShow(2)'>同意</a></div>
      </div>
    </div>
  </div>
  </body>
  <script type="text/javascript" src="../script/api.js"></script>
  <script src="../script/jquery.min.js"></script>
  <script type="text/javascript" src="../script/vue.js"></script>
  <script type="text/javascript" src="../script/util.js"></script>
  <script src="../script/configUtil.js" charset="utf-8"></script>
  <script type="text/javascript">

    apiready = function (){
      api.setStatusBarStyle({
              style: 'dark',
              color: 'rgba(255,255,255,0)'
      });
    	var vm = new Vue({
    		el: '#app',
    		data:{
          flrst_xy:false,
    			showLogin: false, //登录盒子是否显示
          show1Login: false, //登录盒子是否显示
    			showRegistered: false, //注册盒子是否显示
    			showForget: false, //忘记密码盒子是否显示
    			loginData:{ //登录盒子信息
    				showEye: false, //密码是否显示
    				password: '', //密码
    				phone: '', //手机号,
            code:''
    			},
          code_view:true,
          time:60,
          isDisabled:false,
    			forgetData:{ //忘记密码盒子信息
    				phone:'', //手机号
    				password:'', //密码
    				code:'', //验证码
    				passwordAgain:'', //再次输入密码
    				showEye1:false, //密码 是否显示
    				showEye2:false, //再次输入密码 是否显示
    				time: 60, //获取验证码间隔时间
    				canGetCode: true //是否可获取验证码
    			},
    			registeredData:{
    				phone: '',
    				password: '',
    				passwordAgain: '',
    				userName: '',
    				code: '',
    				showEye1: false, //密码 是否显示
    				showEye2: false, //再次输入密码 是否显示
    				time: 60, //获取验证码间隔时间
    				canGetCode: true, //是否可获取验证码
    				isChoose: true,
            refer_code:'',
            isxiey:true,
            islg:true
          },
          deviceId:'',
          deviceType:'',
          agentQrcode:api.pageParam.agentQrcode||''
    		},
    	  mounted: function (){
              var that =this;
              var isxy = window.localStorage.getItem('is_xyShow')||true
              if(typeof isxy== 'boolean'){
                that.flrst_xy =isxy

              }else{
                 that.flrst_xy = eval(isxy.toLowerCase())
              }
    		      that.$nextTick(function(){
                api.addEventListener({//阻止后退
                   name: 'keyback'
                 }, function(ret, err) {

                 });
    		          api.addEventListener({
    		              name:'apprunning',
    		          }, function(ret, err) {
    		              that.setyes(JSON.stringify(ret.value.yes))
    		              // alert(JSON.stringify(ret.value));

    		          });
             })
             var registrationId = window.localStorage.getItem('registrationId');

            console.log('registrationId:'+registrationId);
            this.deviceId = registrationId;
            this.deviceType =  api.systemType == 'ios'?'1':'2';
            if(that.agentQrcode!=''){
              that.showRegisteredBox()
              that.registeredData.refer_code =that.agentQrcode

            }

    		},
    		methods:{
          getAddCode:function(){
            var that = this;
            if(!isMobile(this.loginData.phone)){
              that.toast('请输入正确手机号')
              return
            }
            var param = {
              mobile: this.loginData.phone,
              event:'login'
            }
            that.ajaxpost('post',globalData.codelogin,param).then((res)=>{
              var res =$.parseJSON(res);
              if(res.code==1){
                that.code_view = false;
                that.isDisabled = true;
                var timer = setInterval(function () {
                  that.time--;
                  if (that.time < 0) {
                    that.code_view = true
                    that.isDisabled = false
                    that.time = 60
                    clearInterval(timer)
                  }
                }, 1000)
              }
            }).catch((ret)=>{
              loginfo(ret)
            })
          },
          is_xyShow(type){
            if(type==2){

              window.localStorage.setItem('is_xyShow',false)
              this.flrst_xy =false
            }else{
              window.localStorage.setItem('is_xyShow',true)
              this.flrst_xy =false
            }
          },
    			//切换眼睛图标
    			closeOropen(type){
    				if(type == 1){
    					this.loginData.showEye = !this.loginData.showEye;
    				}else if(type == 2){
    					this.forgetData.showEye1 = !this.forgetData.showEye1;
    				}else if(type == 3){
    					this.forgetData.showEye2 = !this.forgetData.showEye2;
    				}else if(type == 4){
    					this.registeredData.showEye1 = !this.registeredData.showEye1;
    				}else if(type == 5){
    					this.registeredData.showEye2 = !this.registeredData.showEye2;
    				}
    			},
    			//关闭登录或者注册盒子
    			closeBox(){
    				this.showLogin = false;
            this.show1Login = false;
    				this.showRegistered = false;
    				this.showForget = false;
    			},
          // 同意
          setyes(name){
            console.log(name)
            if(name==1){
                this.registeredData.isChoose= true;
            }
            if(name==2){
              this.registeredData.isxiey= true;
            }
            // console.log(name);
          },
          //不同意
          noClause(){
            this.registeredData.isChoose= !this.registeredData.isChoose;
          },
          //打开条款盒子
          showClauseBox(){

            this.openW('clause_win',{type:1},true)
          },
          showXieyBox(){
            this.openW('clause_win',{type:2},true)
          },
    			//打开登录盒子
    			showLoginBox(){
            var isxy = window.localStorage.getItem('is_xyShow')

           if(eval(isxy.toLowerCase())){

             this.flrst_xy =true
             return
           }
    				this.showForget = false;
    				this.showLogin = true;
    				this.showRegistered = false;
    			},
          showLogin1Box(){
            var isxy = window.localStorage.getItem('is_xyShow')

           if(eval(isxy.toLowerCase())){

             this.flrst_xy =true
             return
           }
    				this.showForget = false;
    				this.show1Login = true;
    				this.showRegistered = false;
    			},
    			//打开注册盒子
    			showRegisteredBox(){
    				this.showRegistered = true;
    				this.showForget = false;
    				this.showLogin = false;
            this.show1Login = false;
    			},
    			//打开忘记密码盒子
    			forget(){
    				this.showForget = true;
    				this.showLogin = false;
            this.show1Login = false;
    				this.showRegistered = false;
          },
          xiuy(){

          },
    			//获取验证码
    			getCode(type){
            var that = this;
    				if(type == 1){
    					if(!this.forgetData.canGetCode){
    						return
    					}
              if(testFunction.isMobile(that.forgetData.phone)!=true){

                that.toast('手机号码有误')
                return
              }

              that.ajaxpost('post',globalData.codelogin,{mobile:that.forgetData.phone,event:'resetpwd'}).then((res)=>{
                  var res =$.parseJSON(res)
                  console.log(res)
                  if(res.code==1){
                    that.toast(res.msg)
          					this.forgetData.canGetCode = false;
          					var timer = setInterval(function(){
          						that.forgetData.time --;
          						if(that.forgetData.time < 0){
          							clearInterval(timer);
          							that.forgetData.canGetCode = true;
          							that.forgetData.time = 60;
          						}
          					},1000)
                    return
                  }
                  if(res.code==0){
                    that.toast(res.msg)
                    return
                  }
              }).catch((ret)=>{
                loginfo(ret)
              })
    				}else if(type == 2){//注册-验证码

    					if(!this.registeredData.canGetCode){
    						return
    					}
              if(testFunction.isMobile(that.registeredData.phone)!=true){
                api.alert({
                  title: '提示',
                  msg: '手机号码有误'
                })
                return
              };


              that.ajaxpost('post',globalData.codelogin,{mobile:that.registeredData.phone,event:'register'}).then((res)=>{
                  var res =$.parseJSON(res)
                  if(res.code==1){
                      that.toast(res.msg)
                      this.registeredData.canGetCode = false;
                      var timer = setInterval(function(){
                        that.registeredData.time --;
                        if(that.registeredData.time < 0){
                          clearInterval(timer);
                          that.registeredData.canGetCode = true;
                          that.registeredData.time = 60;
                        }
                      },1000)
                    return
                  }
                  if(res.code==0){
                      that.toast(res.msg)
                    return
                  }
              }).catch((ret)=>{
                loginfo(ret)
              })
    				}
    			},
          //登录
    			login(){
            var that =this
    				var data = {
    					mobile: this.loginData.phone,
              password: this.loginData.password,
              platform:this.deviceType,
              registration_id:this.deviceId,
              identity:2
    				}
            if(data.mobile==''){

              that.toast('请输入手机')
              return
            }
            if(data.password==''){

              that.toast('请输入密码')
              return
            }

            if(testFunction.registerPassword(data.password)!=true){

              that.toast('请输入数字和字母结合的6-12位密码')
              return
            }
            if(this.registeredData.isxiey==false){

              that.toast('请同意用户协议')
              return
            }

            this.ajaxpost('post',globalData.login,data).then((res)=>{

              var res =$.parseJSON(res);
              console.log(JSON.stringify(res))
              if(res.code==1){
                window.localStorage.setItem('userinfo',res.data.token)

                console.log(JSON.stringify(res))
                api.sendEvent({
                    name: 'root_data',
                    extra: '刷新'
                });

                api.closeToWin({
                    name: 'root'
                });
                api.addEventListener({//阻止后退
                   name: 'keyback'
                 }, function(ret, err) {
                     api.closeWidget()
                 });
              }
              if(res.code==0){

                that.toast(res.msg)
                return
              }
            }).catch((err)=>{
              console.log(JSON.stringify(err))
            })
          },
          login1(){
            var that =this
    				var data = {
    					mobile: this.loginData.phone,
              captcha: this.loginData.code,
              platform:this.deviceType,
              registration_id:this.deviceId,
              identity:2
    				}
            if(data.mobile==''){

              that.toast('请输入手机')
              return
            }
            if(data.captcha==''){

              that.toast('请输入验证码')
              return
            }

            if(this.registeredData.isxiey==false){

              that.toast('请同意用户协议')
              return
            }
            console.log(JSON.stringify(data))
            this.ajaxpost('post',globalData.login1,data).then((res)=>{

              var res =$.parseJSON(res);
              console.log(JSON.stringify(res))
              if(res.code==1){
                window.localStorage.setItem('userinfo',res.data.token)

                console.log(JSON.stringify(res))
                api.sendEvent({
                    name: 'root_data',
                    extra: '刷新'
                });

                api.closeToWin({
                    name: 'root'
                });
                api.addEventListener({//阻止后退
                   name: 'keyback'
                 }, function(ret, err) {
                     api.closeWidget()
                 });
              }
              if(res.code==0){

                that.toast(res.msg)
                return
              }
            }).catch((err)=>{
              console.log(JSON.stringify(err))
            })
          },
          navhome(){
            api.sendEvent({
                name: 'my_to_home',
                extra: '刷新'
            });

            this.closeTo('root')
          },
          //立即注册
    			registered(){
            var that =this
    				var data = {
    					mobile: this.registeredData.phone,
    					password: this.registeredData.password,
    					confirm_password: this.registeredData.passwordAgain,
              identity:2,
    					captcha: this.registeredData.code,
    					nickname: this.registeredData.userName,
              refer_code: this.registeredData.refer_code,
              platform:this.deviceType,
              registration_id:this.deviceId,
    				}
            console.log(testFunction)
            if(testFunction.isMobile(data.mobile)!=true){

              that.toast('手机号码有误')
              return
            }
            if(data.captcha==''){
              that.toast('验证码不能为空')

              return
            }
            if(data.nickname==''){

              that.toast('昵称不能为空')
              return
            }
            if(testFunction.registerPassword(data.password)!=true){

              that.toast('请输入数字和字母结合的6-12位密码')
              return
            }
            if(data.confirm_password!=data.password){

              that.toast('密码不相同')
              return
            }
            if(this.registeredData.isChoose==false){
              api.alert({
                title: '提示',
                msg: '请同意隐私协议'
              })
              return
            }
            this.ajaxpost('post',globalData.restuser,data).then((res)=>{
                var res =$.parseJSON(res);
                if(res.code==1){
                  that.toast(res.msg)
                  window.localStorage.setItem('userinfo',res.data.token)
                  setTimeout(function(){
                    console.log(JSON.stringify(res))
                    api.sendEvent({
                        name: 'root_data',
                        extra: '刷新'
                    });
                    api.closeToWin({
                        name: 'root'
                    });
                    api.addEventListener({//阻止后退
                       name: 'keyback'
                     }, function(ret, err) {
                         api.closeWidget()
                     });
                  },2000)
                }
                if(res.code==0){

                  that.toast(res.msg)
                };
            })
    				console.log(data)
    			},
          //重置
    			forgotPassword(){
            var that =this
    				var data = {
    					mobile: that.forgetData.phone,
    					password: that.forgetData.password,
    					confirm_password: that.forgetData.passwordAgain,
    					captcha: that.forgetData.code
    				}
            if(testFunction.isMobile(data.mobile)!=true){

              that.toast('手机号码有误')
              return
            }
            if(data.captcha==''){

              that.toast('验证码不能为空')
              return
            }
            if(testFunction.registerPassword(data.password)!=true){

              that.toast('请输入6-12位字母加数字')
              return
            }
            if(data.confirm_password!=data.password){

              that.toast('密码不相同')
              return
            }
            that.ajaxpost('post',globalData.restpassword,data).then((res)=>{
              var res =$.parseJSON(res);
                if(res.code==1){

                  that.toast(res.msg)
                  that.closeBox()
                }
                if(res.code==0){
                    that.toast(res.msg)
                }
            })
    				console.log(data)
    			}
    		}
    	})
  }
  </script>
  </html>
